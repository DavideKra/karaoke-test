<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sai tenere un segreto?</title>

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Rubik+Dirt&display=swap" rel="stylesheet">

<style>
:root{
  --fg:#fff;
  --muted:rgba(255,255,255,.65);
}

*{box-sizing:border-box}
html,body{margin:0;height:100%}

body{
  font-family:'Rubik Dirt', system-ui, sans-serif;
  color:var(--fg);
  overflow:hidden;
  background:#000;
}

/* =====================
   BACKGROUND (RESPIRA FORTE)
   ===================== */
#bg{
  position:fixed;
  inset:0;
  z-index:0;
  background-image:
    linear-gradient(to bottom, rgba(0,0,0,.45), rgba(0,0,0,.88)),
    url("https://i.ibb.co/nsyZJK7W/Sai-Tenere-Un-Segreto.png");
  background-repeat:no-repeat;
  background-position:center;
  background-size:contain;

  /* più veloce + più ampio */
  animation:bgZoom 14s cubic-bezier(.4,0,.6,1) infinite;
}

@keyframes bgZoom{
  0%   { transform:scale(1); }
  50%  { transform:scale(1.22); }
  100% { transform:scale(1); }
}

/* =====================
   INTRO (HOME)
   ===================== */
#intro{
  position:fixed;
  inset:0;
  z-index:10;
  display:flex;
  flex-direction:column;
  align-items:center;
  background:rgba(0,0,0,.6);
}

#intro h1{
  margin-top:64px;
  margin-bottom:12px;
  font-family:Creepster, cursive;
  font-size:clamp(36px,6vw,72px);
  text-align:center;
}

#intro .author{
  font-size:16px;
  color:var(--muted);
}

#start{
  margin-top:auto;
  margin-bottom:64px;
  font-size:14px;
  color:var(--muted);
  cursor:pointer;
}

#intro.hide{
  opacity:0;
  pointer-events:none;
  transition:opacity .8s ease;
}

/* =====================
   STAGE (KARAOKE)
   ===================== */
#stage{
  position:fixed;
  inset:0;
  z-index:20;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:40px;
  pointer-events:none;
}

#line{
  font-family:'Rubik Dirt', cursive;
  max-width:1100px;
  text-align:center;
  font-size:clamp(34px,5vw,62px);
  line-height:1.25;
  text-shadow:
    0 12px 44px rgba(0,0,0,.95),
    0 0 14px rgba(0,0,0,.7);
  opacity:0;
  transition:
    transform .45s ease,
    filter .45s ease,
    opacity .35s ease;
}

/* =====================
   PLAYER (HIDDEN INIT)
   ===================== */
#audio{display:none}

#controls{
  position:fixed;
  bottom:26px;
  left:50%;
  transform:translateX(-50%);
  display:none;
  gap:24px;
  font-size:13px;
  color:var(--muted);
  z-index:30;
}

#controls button{
  background:none;
  border:none;
  color:inherit;
  cursor:pointer;
  font-family:inherit;
}

#controls button:hover{
  color:#fff;
  text-decoration:underline;
}

/* =====================
   TRANSITIONS
   ===================== */
.fade{opacity:1;transform:none}
.slide-up{opacity:1;transform:translateY(48px)}
.slide-down{opacity:1;transform:translateY(-48px)}
.zoom{opacity:1;transform:scale(1.2)}
.blur{opacity:1;filter:blur(14px)}
.rotate{opacity:1;transform:rotate(-3deg) scale(.93)}
.stretch{opacity:1;transform:scaleY(.55)}
.slide-x{opacity:1;transform:translateX(-70px)}
</style>
</head>

<body>

<div id="bg"></div>

<!-- INTRO -->
<div id="intro">
  <h1>Sai tenere un segreto?</h1>
  <div class="author">DavideKra</div>
  <div id="start">clicca per iniziare</div>
</div>

<!-- KARAOKE -->
<div id="stage">
  <div id="line"></div>
</div>

<!-- PLAYER -->
<div id="controls">
  <button id="back">−10s</button>
  <button id="play">play</button>
  <button id="forward">+10s</button>
</div>

<audio id="audio" preload="metadata">
  <source src="DavideKra - 02 - Sai Tenere Un Segreto.mp3" type="audio/mpeg">
  <track id="lyricsTrack" kind="subtitles" srclang="it"
         src="DavideKra - 02 - Sai Tenere Un Segreto.vtt" default>
</audio>

<script>
const audio=document.getElementById("audio");
const trackEl=document.getElementById("lyricsTrack");
const line=document.getElementById("line");
const intro=document.getElementById("intro");
const controls=document.getElementById("controls");

const playBtn=document.getElementById("play");
const backBtn=document.getElementById("back");
const forwBtn=document.getElementById("forward");

let lastCue=null;
const transitions=["fade","slide-up","slide-down","zoom","blur","rotate","stretch","slide-x"];
const rand=()=>transitions[Math.floor(Math.random()*transitions.length)];

/* START */
document.getElementById("start").onclick=async()=>{
  await audio.play();
  intro.classList.add("hide");
  controls.style.display="flex";
  playBtn.textContent="pause";
};

/* PLAY */
playBtn.onclick=()=>{
  if(audio.paused){audio.play();playBtn.textContent="pause";}
  else{audio.pause();playBtn.textContent="play";}
};

/* SEEK */
backBtn.onclick=()=>audio.currentTime=Math.max(0,audio.currentTime-10);
forwBtn.onclick=()=>audio.currentTime=Math.min(audio.duration,audio.currentTime+10);
audio.addEventListener("seeked",()=>lastCue=null);

/* KARAOKE */
trackEl.addEventListener("load",()=>{
  const track=trackEl.track;
  track.mode="hidden";

  const refresh=()=>{
    const a=track.activeCues;
    if(!a||!a.length){
      line.style.opacity=0;
      return;
    }
    const cue=a[0];
    if(cue===lastCue)return;
    lastCue=cue;

    const t=rand();
    line.className=t;
    line.style.opacity=0;

    setTimeout(()=>{
      line.textContent=cue.text;
      line.className="fade";
      line.style.opacity=1;
    },240);
  };

  track.addEventListener("cuechange",refresh);
  audio.addEventListener("timeupdate",refresh);
});
</script>

</body>
</html>
