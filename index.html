<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DavideKra — Album</title>

<link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt&family=Inter:wght@700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  background:#000;
  font-family:Inter, system-ui, sans-serif;
  color:#fff;
}

/* ===== STAGE ===== */
#stage{
  position:fixed;
  inset:0;
  perspective:1400px;
}
#world{
  position:absolute;
  inset:0;
  transform-style:preserve-3d;
}

/* ===== SCENE ===== */
.scene{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  transform-style:preserve-3d;
  transition:opacity .4s ease;
}

.scene.hidden-meta .meta{
  opacity:0;
}

/* ===== META ===== */
.meta{
  text-align:center;
  transition:opacity .4s ease;
}

.meta h1{
  font-family:'Rubik Dirt', cursive;
  font-size:clamp(34px,6vw,68px);
  margin:0;
}
.meta .artist{
  margin-top:8px;
  opacity:.7;
}

/* ===== KARAOKE ===== */
#karaoke{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}
#line{
  font-family:'Rubik Dirt', cursive;
  font-size:clamp(30px,5vw,58px);
  max-width:1100px;
  text-align:center;
  line-height:1.25;
  text-shadow:0 12px 44px rgba(0,0,0,.95);
  opacity:0;
  transition:opacity .3s ease;
}

/* ===== PLAYER ===== */
#audio{display:none}
#controls{
  position:fixed;
  bottom:26px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:24px;
  font-size:13px;
  opacity:.85;
  z-index:20;
}
#controls button{
  background:none;
  border:none;
  color:inherit;
  cursor:pointer;
}
#controls button:hover{text-decoration:underline}
</style>
</head>

<body>

<div id="stage">
  <div id="world"></div>
</div>

<!-- AUDIO -->
<audio id="audio" preload="metadata"></audio>

<!-- PLAYER -->
<div id="controls">
  <button id="back">−10s</button>
  <button id="play">play</button>
  <button id="forward">+10s</button>
</div>

<script>
/* =====================
   TRACKLIST
   ===================== */
const tracks = [
  {
    title:"Sai tenere un segreto?",
    artist:"DavideKra",
    cover:"https://i.ibb.co/nsyZJK7W/Sai-Tenere-Un-Segreto.png",
    audio:"DavideKra - 02 - Sai Tenere Un Segreto.mp3",
    vtt:"DavideKra - 02 - Sai Tenere Un Segreto.vtt"
  },
  {
    title:"2 Cose Insieme",
    artist:"DavideKra",
    cover:"https://i.ibb.co/yndKknVM/2-cose-insieme.png",
    audio:null,
    vtt:null
  }
];

const SCENE_DEPTH = 1200;
const world = document.getElementById("world");
const scenes = [];

/* =====================
   CREATE SCENES
   ===================== */
tracks.forEach((t,i)=>{
  const s=document.createElement("div");
  s.className="scene";
  s.style.background=`
    linear-gradient(to bottom, rgba(0,0,0,.45), rgba(0,0,0,.9)),
    url("${t.cover}")`;
  s.style.backgroundRepeat="no-repeat";
  s.style.backgroundPosition="center";
  s.style.backgroundSize="contain";

  s.innerHTML=`
    <div class="meta">
      <h1>${t.title}</h1>
      <div class="artist">${t.artist}</div>
    </div>
  `;

  s.style.transform=`translateZ(${-i*SCENE_DEPTH}px)`;
  world.appendChild(s);

  scenes.push({el:s,z:-i*SCENE_DEPTH,track:t});
});

/* =====================
   CAMERA + ACTIVE SCENE
   ===================== */
let cameraZ=0;
let activeIndex=0;
const audio=document.getElementById("audio");
const playBtn=document.getElementById("play");

function stopAudio(){
  audio.pause();
  audio.src="";
  playBtn.textContent="play";
  scenes.forEach(s=>s.el.classList.remove("hidden-meta"));
  document.getElementById("line").style.opacity=0;
}

function updateScenes(){
  let closest=0;
  let minDist=Infinity;

  scenes.forEach((s,i)=>{
    const rz=s.z+cameraZ;
    const dist=Math.abs(rz);
    if(dist<minDist){minDist=dist;closest=i;}

    const t=Math.max(0,1-dist/SCENE_DEPTH);
    s.el.style.transform=`translateZ(${rz}px) scale(${0.7+t*0.3})`;
    s.el.style.opacity=t;
  });

  if(closest!==activeIndex){
    activeIndex=closest;
    stopAudio();
  }
}

window.addEventListener("wheel",(e)=>{
  e.preventDefault();
  cameraZ+=e.deltaY*0.9;
  cameraZ=Math.max(0,Math.min((tracks.length-1)*SCENE_DEPTH,cameraZ));
  updateScenes();
},{passive:false});

updateScenes();

/* =====================
   PLAY / PAUSE
   ===================== */
playBtn.onclick=()=>{
  const scene=scenes[activeIndex];
  if(!scene.track.audio) return;

  if(audio.paused){
    audio.src=scene.track.audio;
    audio.play();
    playBtn.textContent="pause";
    scene.el.classList.add("hidden-meta");
  }else{
    audio.pause();
    playBtn.textContent="play";
    scene.el.classList.remove("hidden-meta");
  }
};

document.getElementById("back").onclick=()=>audio.currentTime=Math.max(0,audio.currentTime-10);
document.getElementById("forward").onclick=()=>audio.currentTime=Math.min(audio.duration||0,audio.currentTime+10);

/* =====================
   KARAOKE (SCENA 1)
   ===================== */
const karaoke=document.createElement("div");
karaoke.id="karaoke";
karaoke.innerHTML='<div id="line"></div>';
document.body.appendChild(karaoke);

const line=document.getElementById("line");
let trackEl=null,lastCue=null;

audio.addEventListener("loadedmetadata",()=>{
  if(trackEl) trackEl.remove();
  const scene=scenes[activeIndex];
  if(!scene.track.vtt) return;

  trackEl=document.createElement("track");
  trackEl.kind="subtitles";
  trackEl.src=scene.track.vtt;
  trackEl.default=true;
  audio.appendChild(trackEl);

  trackEl.addEventListener("load",()=>{
    const track=trackEl.track;
    track.mode="hidden";
    track.addEventListener("cuechange",()=>{
      const a=track.activeCues;
      if(!a||!a.length){line.style.opacity=0;return;}
      const cue=a[0];
      if(cue===lastCue)return;
      lastCue=cue;
      line.style.opacity=0;
      setTimeout(()=>{
        line.textContent=cue.text;
        line.style.opacity=1;
      },200);
    });
  });
});
</script>

</body>
</html>
